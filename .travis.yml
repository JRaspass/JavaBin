after_success: "[ $CC == gcc ] && cover -report coveralls -test"
env:
    # Latest stable, defaults with each compiler.
    - CC=clang PB_OPT=perl-5.18.2
    - CC=gcc   PB_OPT=perl-5.18.2

    # Test latest perl.
    - CC=gcc   PB_OPT=perl-5.20.0-RC1

    # Test weird and whacky options.
    - CC=gcc   PB_OPT='--64all  perl-5.18.2'
    - CC=gcc   PB_OPT='--64int  perl-5.18.2'
    - CC=gcc   PB_OPT='--ld     perl-5.18.2'
    - CC=gcc   PB_OPT='--multi  perl-5.18.2'
    - CC=gcc   PB_OPT='--thread perl-5.18.2'
install:
    - sudo ln -fs $(which $CC) /usr/bin/cc
    - perlbrew install -DNO_MATHOMS -DPERL_DISABLE_PMC -j`nproc` -n --noman $PB_OPT
    - perlbrew use `echo $PB_OPT | awk '{print $NF}'`
    - cpanm -nq Test::Fatal
    - "if [ $CC == gcc ]; then cpanm -nq Devel::Cover::Report::Coveralls IO::Socket::SSL; fi"
language: perl
script:
    - perl Makefile.PL INSTALLMAN3DIR=none NO_MYMETA=1
    - make
    - prove -bl
